<!DOCTYPE html>
<html>
  <head>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="js/binaryheap.js?v=0"></script>
    <script src="js/simulation.js?v=0"></script>
    <script src="js/infinigraph.js?v=0"></script>
</head>
<style>
    #data {
        position: absolute;
        top: 0px;
        left: 0px;
        /*background-color: #DFF1FF;*/
        border-width: 1px;
        border-color: black;
        border-style: solid;
    }
</style>
  <body>
    <div id="data"></div>

<script type="text/javascript">
var board, sim, graph, alpha=0.439, doszr=true;

function init(){
    var width = window.innerHeight < window.innerWidth ?
        window.innerHeight : window.innerWidth;
    width -= 2;
    var height = width;

    document.getElementById('data')
        .setAttribute("style","width:"+width+"px; height:"+height+"px;");

    graph = new InfiniGraph("data");
}

function dostep() {
    var csites = [];
    var next_time = sim.time + 0.1;
    while (sim.time <= next_time) {
    //for (var i=0; i<30; i++){
        var sites = sim.dostep();
        if (!sites) {
            graph.update_sites(csites);
            window.clearInterval(intID);
            return;
        }
        csites = csites.concat(sites);
    }

    graph.update_sites(csites);
}

var intID;
function launch(){
    reset();

    sim.addZombieSeed(0, 0, simulation.S2Z);
    graph.update_sites(sim.sites);

    intID = setInterval(dostep, 1);
}

function stop(){
    window.clearInterval(intID);
}

function reset(){
    stop();

    board = new simulation.InfiniteBoard(1);
    sim = new simulation.Simulation(board);
    sim.mu = 1.0;

    if (doszr){
        sim.static_types = [simulation.S2Z, simulation.Z2R];
        sim.motion_types = [simulation.S2Z, simulation.Z2R];
        //sim.motion_types = [simulation.MOV];
        sim.alpha = alpha;
    } else {
        sim.static_types = [simulation.S2Z, simulation.I2R];
        sim.motion_types = [simulation.S2Z];
        //sim.motion_types = [simulation.MOV];
        sim.alpha = 0.836;
    }

    graph.reset_display();
}

function change_alpha(slider){
    alpha = slider.value;
    document.getElementById('label').innerHTML = ""+alpha;
    if (sim) sim.alpha = alpha;
}

function change_szr(check){
    doszr = check.checked;
}

init();
reset();

</script>
<br/>
<input type='button' value='go' style='top: 0; left: 0; position: absolute;' onclick='launch();'/>
<input type='button' value='stop' style='top: 0; left: 35px; position: absolute;' onclick='stop();'/>
<input type='range' name='alpha' style='width: 400px; top: 2px; left: 82px; position: absolute;' min=0.001 max=1 step=0.001 value=0.439 oninput='change_alpha(this)' onchange='change_alpha(this);'/>
<span id='label' style='top: 5px; left: 500px; position: absolute;'>0.439</span>
<input type='checkbox' name='doszr' style='position: absolute; top: 4px; left: 540px;' value='SZR' checked='checked' onchange='change_szr(this)'/>
<span id='label' style='top: 5px; left: 558px; position: absolute;'>SZR</span>
  </body>
</html>
